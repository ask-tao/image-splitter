# 智能图片拆分工具 (Image Split)

## 1. 项目介绍

这是一个基于 Web 技术的图集拆分工具，旨在帮助游戏开发者或 UI 设计师快速、方便地从一张雪碧图 (Sprite Sheet) 或图集中，提取出所有独立的精灵或 icon 资源。

本工具完全在浏览器端运行，无需任何后端服务，保证了素材的本地性和安全性。它提供了从全自动识别到精细化手动调整的全套解决方案。

## 2. 项目特点

- **智能自动识别**: 能够自动分析图集中的透明像素，精确地找到所有独立的、非连续的图像块，并为它们生成初始的包围框。
- **全功能交互式编辑器**:
    - **所见即所得**: 所有操作都在一个可视化的 Canvas 画布上进行。
    - **自由创建**: 支持用鼠标拖拽，在任意位置创建新的选框。
    - **精准编辑**: 可以选中、移动、删除选框，并支持通过 8 个锚点进行缩放。
    - **等比缩放**: 在拖拽四角的锚点时，能够保持选框的原始宽高比。
- **实时预览**: 选中任意一个选框时，右侧的预览窗口会立即展示该选框裁剪出的图像，方便确认细节。
- **灵活的边距与填充**:
    - **画布外边距**: 自动为载入的图集增加一块“安全”的外边距，便于框选位于图集最边缘的元素。
    - **识别内边距**: 支持自定义一个内边距值，让自动识别出的选框可以向外扩大，以保留元素周围必要的透明区域。
- **强大的导出功能**:
    - **打包下载**: 一键将所有选框内的图片打包成一个 `.zip` 压缩文件，方便管理。
    - **自定义命名**: 支持自定义文件名的`前缀`和`连接符`。
    - **实时命名预览**: 在输入框下方实时展示最终导出的文件名格式，如 `sprite_1.png`。
- **健壮的用户界面**: 基于 Vue 3 和 Element Plus 构建，提供了稳定、一致且美观的操作体验。

## 3. 技术方案及其原理

本工具主要采用现代前端技术栈构建，核心原理围绕 `Canvas` 的像素级操作和图像处理算法。

- **核心框架**: **Vue 3 + Vite + TypeScript**
  - **Vue 3**: 利用其强大的响应式系统来管理选框列表、配置项等复杂状态，并通过组件化的方式构建 UI。
  - **Vite**: 提供极速的开发服务器和高效的构建能力。
  - **TypeScript**: 为项目提供了类型安全，增强了代码的可维护性。

- **UI 库**: **Element Plus**
  - 提供了一套高质量的 Vue 3 组件，用于快速构建布局、表单、按钮、对话框等界面元素。

- **图形与交互**: **HTML5 Canvas API**
  - **渲染**: 负责将用户上传的图集绘制到主画布上，并根据数据实时渲染所有的选框和锚点。
  - **交互**: 通过监听画布的 `mousedown`, `mousemove`, `mouseup` 等鼠标事件，实现选框的创建、选择、移动和缩放等所有手动编辑逻辑。
  - **图像裁剪**: 在导出和预览时，利用 `drawImage()` 方法从原始图集中精确地提取出指定选框内的像素数据。

- **核心算法：自动识别原理**
  自动识别的核心是一种**连通分量标记 (Connected-component labeling)** 算法，通过广度优先搜索 (BFS) 实现：
  1.  **像素扫描**: 将整个图集看作一个二维像素网格。算法从左上到右下逐个像素进行扫描。
  2.  **寻找“岛屿”**: 当遇到一个尚未被访问过的“不透明”像素时（Alpha > 0），就认为发现了一个新的图像块（“岛屿”），并从这个像素开始进行搜索。
  3.  **洪水填充 (Flood Fill)**: 以该像素为起点，启动**广度优先搜索 (BFS)**。算法会查找所有与它相邻（上下左右）且同样是不透明的像素，并将它们加入一个队列中。这个过程不断持续，直到探索完所有与初始点相连的像素，就像洪水蔓延过整座小岛一样。
  4.  **边界记录**: 在 BFS 的过程中，用变量记录下所有被访问过的像素中 `x` 和 `y` 坐标的最小值和最大值 (`minX`, `maxX`, `minY`, `maxY`)。这四个值就构成了该“岛屿”的最小外接矩形。
  5.  **访问标记**: 为了防止重复识别和死循环，所有被访问过的像素都会被记录在一个 `visited` 矩阵中，后续扫描会直接跳过它们。
  6.  **循环**: 当一个“岛屿”搜索完毕后，外层的像素扫描会继续进行，直到找到下一个尚未被访问的“岛屿”，重复以上过程，直到所有像素都被访问完毕。

- **导出方案**: **JSZip**
  - 为了解决浏览器对连续多次下载的限制，并提升用户体验，导出功能使用了 `JSZip` 库。
  - 程序会遍历所有选框，将每一个裁剪出的图片数据 (Blob) 添加到内存中的一个 `JSZip` 实例里。
  - 循环结束后，`JSZip` 会将内存中的所有图片生成为一个 `.zip` 压缩包的 Blob 数据，最后通过 `URL.createObjectURL` 创建一个下载链接，实现单次、可靠的批量下载。